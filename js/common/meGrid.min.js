!function(t,e){var i=function(t){return new i.fn._construct(t)};i.fn=i.prototype={constructor:i,_construct:function(t){for(var e in null!=t&&this.extend({options:t}),this.options.grid.caption||(this.options.grid.caption=this.options.title),this.options.grid.url||(this.options.grid.url=this.getUrl("search")),this.options.grid.pager||(this.options.grid.pager=this.options.pageSelector),this.options.createOptions.url||(this.options.createOptions.url=this.getUrl("create")),this.options.updateOptions.url||(this.options.updateOptions.url=this.getUrl("update")),this.options.grid.editurl||(this.options.grid.editurl=this.getUrl("update")),this.options.deleteOptions.url||(this.options.deleteOptions.url=this.getUrl("deleteAll")),this.options.bOperation&&(this.options.operation.title||(this.options.operation.title=this.getLanguage("operation")),this.options.operation.formatoptions.delOptions.url||(this.options.operation.formatoptions.delOptions.url=this.getUrl("delete"))),this.options.buttons)null!=this.options.buttons[e]&&1==this.options.buttons[e].show&&(this.options.buttonOptions[e]=!0,this.options.buttons[e].text||(this.options.buttons[e].text=this.getLanguage(e)),this.options.buttonHtml+='<button class="'+this.options.buttons[e].className+'" id="'+this.options.gridSelector.replace("#","")+"-"+e+'">                                <i class="'+this.options.buttons[e].icon+'"></i>                            '+this.options.buttons[e].text+"                            </button> ");if(this.options.bOperation&&this.options.grid.colModel.length>=1&&this.options.grid.colModel.unshift(this.options.operation),this.options.grid.colModel.length>=1){this.options.colNames=[];var o=this;this.options.grid.colModel.forEach(function(t,e){if(o.options.colNames[e]=t.title,t.gridSearch){t.gridSearch.type||(t.gridSearch.type="text"),t.gridSearch.title=t.title,t.gridSearch.name=t.index;var n="select"==t.gridSearch.type?{All:o.getLanguage("all")}:null;try{o.options.searchHtml+=i[t.gridSearch.type+"Create"](t.gridSearch,t.value,n)}catch(e){console.info(e),o.options.searchHtml+=i.textCreate(t.gridSearch)}}}),this.options.grid.colNames||(this.options.grid.colNames=this.options.colNames),this.options.search.render&&(this.options.searchHtml+='<button class="'+this.options.search.button.class+'">                    <i class="'+this.options.search.button.icon+'"></i>                    '+this.getLanguage("search")+"                    </button>")}return this},init:function(i){this.grid=e(this.options.gridSelector).jqGrid(this.options.grid),e(this.options.buttonSelector).append(this.options.buttonHtml);try{e(this.options.searchSelector)[this.options.search.type](this.options.searchHtml)}catch(t){e(this.options.searchSelector).append(this.options.searchHtml)}var o=this;e(t).on("resize.jqGrid",function(){o.grid.jqGrid("setGridWidth",e(".page-content").width())});var n=o.grid.closest('[class*="col-"]');e(document).on("settings.ace.jqGrid",function(t,e){"sidebar_collapsed"!==e&&"main_container_fixed"!==e||setTimeout(function(){o.grid.jqGrid("setGridWidth",n.width())},0)}),o.grid.jqGrid("navGrid",o.options.pageSelector,o.options.buttonOptions,o.options.updateOptions,o.options.createOptions,o.options.deleteOptions),e(t).triggerHandler("resize.jqGrid"),o.options.buttons.add&&e(o.options.gridSelector+"-add").click(function(t){t.preventDefault(),o.grid.jqGrid("editGridRow","new",o.options.createOptions)}),o.options.buttons.edit&&e(o.options.gridSelector+"-edit").click(function(t){t.preventDefault();var e=o.grid.jqGrid("getGridParam","selrow");null!=e?o.grid.jqGrid("editGridRow",e,o.options.updateOptions):layer.msg(o.getLanguage("selectRow"),{icon:5})}),o.options.buttons.del&&e(o.options.gridSelector+"-del").click(function(){var t=o.grid.jqGrid("getGridParam","selarrrow");null!=t&&t.length>=1?o.grid.jqGrid("delGridRow",t,o.options.deleteOptions):layer.msg(o.getLanguage("selectRow"),{icon:5})}),o.options.buttons.refresh&&e(o.options.gridSelector+"-refresh").click(function(t){t.preventDefault(),o.refresh(!0)}),e(o.options.searchSelector).submit(function(t){t.preventDefault(),o.refresh()}),o.options.buttons.export&&e(document).on("click",o.options.gridSelector+"-export",function(t){t.preventDefault(),o.export()}),e(document).on("ajaxloadstart",function(t){o.grid.jqGrid("GridUnload"),e(".ui-jqdialog").remove()}),"function"==typeof i&&i()},export:function(){this.action="export";var t=this,i='<form action="'+this.getUrl("export")+'" target="_blank" method="POST" class="me-export" style="display:none">';i+='<input type="hidden" name="title" value="'+t.options.title+'"/>';var o=e("meta[name=csrf-param]").attr("content")||"_csrf";i+='<input type="hidden" name="'+o+'" value="'+e("meta[name=csrf-token]").attr("content")+'"/>',this.options.grid.colModel.forEach(function(t){null!=t.index&&!1!==t.bExport&&!1!==t.isExport&&!1!==t.export&&(i+='<input type="hidden" name="fields['+t.index+']" value="'+t.title+'"/>')});var n=e(t.options.searchSelector).serializeArray();for(var a in n)n[a].value&&"All"!=n[a].value&&(i+='<input type="hidden" name="'+n[a].name+'" value="'+n[a].value+'"/>');var r=e(i);e("body").append(r);var s=new e.Deferred,l="temporary-iframe-"+(new Date).getTime()+"-"+parseInt(1e3*Math.random()),c=e('<iframe id="'+l+'" name="'+l+'" \t\t\t\t\t\t\t\tframeborder="0" width="0" height="0" src="about:blank"\t\t\t\t\t\t\t\tstyle="position:absolute; z-index:-1; visibility: hidden;"></iframe>').insertAfter(r);r.append('<input type="hidden" name="temporary-iframe-id" value="'+l+'" />'),c.data("deferrer",s),r.attr({method:"POST",enctype:"multipart/form-data",target:l}),r.get(0).submit();var d=setTimeout(function(){d=null,s.reject(e(document.getElementById(l).contentDocument).text()),e(".me-export").remove()},500);s.fail(function(i){if(i)try{i=e.parseJSON(i),layer.msg(i.msg,{icon:0==i.code?6:5})}catch(e){layer.msg(t.getLanguage("responseError"),{icon:5})}else layer.msg(t.getLanguage("exportSuccess"),{icon:6})}).always(function(){clearTimeout(d)}),s.promise()},refresh:function(t,i){i||(i={page:1}),t&&e(this.options.searchSelector).get(0)&&e(this.options.searchSelector).get(0).reset(),e(this.options.gridSelector).jqGrid("setGridParam",i).trigger("reloadGrid")},getUrl:function(t){return this.options.urlPrefix+this.options.url[t]+this.options.urlSuffix},getLanguage:function(t,e){return e||(e=this.options.language),this.language[e][t]}},i.fn._construct.prototype=i.fn,i.extend=i.fn.extend=function(){var t,e,i=arguments[0]||{},o=1,n=arguments.length;for(n===o&&(i=this,--o);o<n;o++)if(null!=(e=arguments[o]))for(t in e)e[t]!==i[t]&&("object"==typeof i[t]?i[t]=this.extend(i[t],e[t]):void 0!==e[t]&&(i[t]=e[t]));return i},i.fn.extend({options:{title:"",gridSelector:"#grid-table",pageSelector:"#grid-pager",searchSelector:"#grid-search-form",searchHtml:"",buttonHtml:"",buttonSelector:"#grid-buttons",bOperation:!0,language:"zh-cn",urlPrefix:"",urlSuffix:"",url:{search:"search",create:"create",update:"update",delete:"delete",export:"export",upload:"upload",deleteAll:"delete-all"},grid:{viewrecords:!0,rowNum:15,rowList:[15,25,30,50,100],altRows:!0,multiselect:!0,multiboxonly:!0,datatype:"json",mtype:"post",jsonReader:{id:"id",root:"data.rows",page:"data.page",total:"data.total",records:"data.records",repeatiems:!1},height:350},buttonOptions:{edit:!1,editicon:"ace-icon fa fa-pencil blue",add:!1,addicon:"ace-icon fa fa-plus-circle purple",del:!1,delicon:"ace-icon fa fa-trash-o red",search:!1,refresh:!1,refreshicon:"ace-icon fa fa-refresh green",view:!0,viewicon:"ace-icon fa fa-search-plus grey"}},language:{"zh-cn":{responseError:"服务器繁忙,请稍后再试...",selectRow:"请选择需要处理的行",operation:"操作",add:"添加",edit:"编辑",del:"删除",refresh:"刷新",export:"导出",pleaseInput:"请输入",search:"搜索",exportSuccess:"数据正在导出，请稍后...",all:"全部"}}}),i.extend({ajaxResponse:function(t){try{var o=e.parseJSON(t.responseText);return[0==o.code,o.msg]}catch(t){return[!1,i.fn.getLanguage("responseError")]}},style_edit_form:function(t){t.find("input[name=sdate]").datepicker({format:"yyyy-mm-dd",autoclose:!0}).end().find("input[name=stock]").addClass("ace ace-switch ace-switch-5").after('<span class="lbl"></span>');var e=t.next().find(".EditButton .fm-button");e.addClass("btn btn-sm").find('[class*="-icon"]').hide(),e.eq(0).addClass("btn-primary").prepend('<i class="ace-icon fa fa-check"></i>'),e.eq(1).prepend('<i class="ace-icon fa fa-times"></i>'),(e=t.next().find(".navButton a")).find(".ui-icon").hide(),e.eq(0).append('<i class="ace-icon fa fa-chevron-left"></i>'),e.eq(1).append('<i class="ace-icon fa fa-chevron-right"></i>')},style_delete_form:function(t){var e=t.next().find(".EditButton .fm-button");e.addClass("btn btn-sm btn-white btn-round").find('[class*="-icon"]').hide(),e.eq(0).addClass("btn-danger").prepend('<i class="ace-icon fa fa-trash-o"></i>'),e.eq(1).addClass("btn-default").prepend('<i class="ace-icon fa fa-times"></i>')},beforeDeleteCallback:function(t){var o=e(t[0]);if(o.data("styled"))return!1;o.closest(".ui-jqdialog").find(".ui-jqdialog-titlebar").wrapInner('<div class="widget-header" />'),i.style_delete_form(o),o.data("styled",!0)},beforeEditCallback:function(t){var o=e(t[0]);o.closest(".ui-jqdialog").find(".ui-jqdialog-titlebar").wrapInner('<div class="widget-header" />'),i.style_edit_form(o)},updatePagerIcons:function(t){var i={"ui-icon-seek-first":"ace-icon fa fa-angle-double-left bigger-140","ui-icon-seek-prev":"ace-icon fa fa-angle-left bigger-140","ui-icon-seek-next":"ace-icon fa fa-angle-right bigger-140","ui-icon-seek-end":"ace-icon fa fa-angle-double-right bigger-140"};e(".ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon").each(function(){var t=e(this),o=e.trim(t.attr("class").replace("ui-icon",""));o in i&&t.attr("class","ui-icon "+i[o])})},enableTooltips:function(t){e(".navtable .ui-pg-button").tooltip({container:"body"}),e(t).find(".ui-pg-div").tooltip({container:"body"})},handleParams:function(t,e){if(other="",null!=t&&"object"==typeof t){for(var i in e=e||"",t)other+=" "+i+'="'+e+t[i]+'"';other+=" "}return other},searchParams:function(t){var e={id:"search-"+t.name,name:"filters["+t.name+"]",class:"form-control"},i={for:"search-"+name},o=t.options,n=t.labelOptions;return delete t.name,delete t.options,delete t.labelOptions,e=this.extend(e,t),o&&(e=this.extend(e,o)),n&&(i=this.extend(i,n)),{input:e,label:i}},textCreate:function(t){t.placeholder||(t.placeholder=i.fn.getLanguage("pleaseInput")+t.title),t.labelOptions||(t.labelOptions={class:"sr-only"});var e=this.searchParams(t);return'<div class="form-group">                <label'+this.handleParams(e.label)+">"+t.title+'</label>                <input type="text"'+this.handleParams(e.input)+">                </div> "},selectCreate:function(t,e,i){var o=this.searchParams(t),n=null,a="";if(i)for(n in i)a+='<option value="'+n+'" selected="selected">'+i[n]+"</option>";if(e)for(n in e)a+='<option value="'+n+'">'+e[n]+"</option>";return'<div class="form-group">                <label'+this.handleParams(o.label)+">"+t.title+"</label>                <select"+this.handleParams(o.input)+">"+a+"</select>                </div> "}}),i.fn.extend({options:{search:{render:!0,type:"append",button:{class:"btn btn-info btn-sm",icon:"ace-icon fa fa-search"}},grid:{loadComplete:function(){var t=this;setTimeout(function(){i.updatePagerIcons(t),i.enableTooltips(t)},0)},loadBeforeSend:function(t,o){var n=e(i.fn.options.searchSelector).serializeArray();for(var a in n)""!==n[a].value&&"All"!==n[a].value&&(o.data+="&"+encodeURIComponent(n[a].name)+"="+encodeURIComponent(n[a].value))}},createOptions:{closeAfterAdd:!0,recreateForm:!0,viewPagerButtons:!1,beforeShowForm:function(t){var o=e(t[0]);o.closest(".ui-jqdialog").find(".ui-jqdialog-titlebar").wrapInner('<div class="widget-header" />'),i.style_edit_form(o)},afterSubmit:i.ajaxResponse},updateOptions:{recreateForm:!0,closeAfterEdit:!0,beforeShowForm:function(t){var o=e(t[0]);o.closest(".ui-jqdialog").find(".ui-jqdialog-titlebar").wrapInner('<div class="widget-header" />'),i.style_edit_form(o)},afterSubmit:i.ajaxResponse},deleteOptions:{recreateForm:!0,beforeShowForm:function(t){var o=e(t[0]);if(o.data("styled"))return!1;o.closest(".ui-jqdialog").find(".ui-jqdialog-titlebar").wrapInner('<div class="widget-header" />'),i.style_delete_form(o),o.data("styled",!0)},afterSubmit:i.ajaxResponse},operation:{name:"myac",index:"",width:80,fixed:!0,sortable:!1,resize:!1,formatter:"actions",bExport:!1,formatoptions:{keys:!0,delOptions:{recreateForm:!0,beforeShowForm:i.beforeDeleteCallback,afterSubmit:i.ajaxResponse},onSuccess:function(t){var e=i.ajaxResponse(t);return layer.msg(e[1],{icon:e[0]?6:5}),e[0]}},search:!1},buttons:{add:{show:!0,icon:"ace-icon fa fa-plus-circle",className:"btn btn-primary btn-xs"},edit:{show:!0,icon:"ace-icon fa fa-pencil-square-o",className:"btn btn-info btn-xs"},del:{show:!0,icon:"ace-icon fa fa-trash-o ",className:"btn btn-danger btn-xs"},refresh:{show:!0,icon:"ace-icon fa  fa-refresh",className:"btn btn-success btn-xs"},export:{show:!0,icon:"ace-icon glyphicon glyphicon-export",className:"btn btn-warning btn-xs"}}}}),t.meGrid=mg=i}(window,jQuery);