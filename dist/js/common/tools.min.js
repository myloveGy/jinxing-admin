function empty(t){return null==t||""===t}function validateFile(t){var e=[];return t&&"object"==typeof t&&((t.error_count.ext||t.error_count.mime)&&e.push("上传文件类型错误"),t.error_count.size&&e.push("上传文件过大")),e.join(";")}function aceFileInputAjax(t,e){var a=t.closest("form"),n=t.data("ace_input_files"),i=new $.Deferred;if(!n||0===n.length)return i.resolve(),i.promise();if("FormData"in window)formData_object=new FormData,$.each(a.serializeArray(),function(t,e){formData_object.append(e.name,e.value)}),formData_object.append(t.attr("name"),n[0]),t.ace_file_input("loading",!0),i=$.ajax({url:e,type:"Post",processData:!1,contentType:!1,dataType:"json",data:formData_object});else{var r="temporary-iframe-"+(new Date).getTime()+"-"+parseInt(1e3*Math.random()),l=$('<iframe id="'+r+'" name="'+r+'" \t\t\t\t\t\t\t\tframeborder="0" width="0" height="0" src="about:blank"\t\t\t\t\t\t\t\tstyle="position:absolute; z-index:-1; visibility: hidden;"></iframe>').insertAfter(a);a.append('<input type="hidden" name="temporary-iframe-id" value="'+r+'" />'),l.data("deferrer",i),a.attr({method:"POST",enctype:"multipart/form-data",target:r}),t.ace_file_input("loading",!0),a.get(0).submit(),ie_timeout=setTimeout(function(){ie_timeout=null,l.attr("src","about:blank").remove(),i.reject({status:"fail",message:"Timeout!"})},3e4)}return i}function aceFileUpload(t,e){var a,n=$(t),i=$("input[type=hidden][name="+n.attr("input-name")+"]"),r=n.attr("allowExt")?n.attr("allowExt").split(","):null,l=n.attr("allowMime")?n.attr("allowMime").split(","):null,o=parseInt(n.attr("maxSize")),u=n.attr("denyExt")?n.attr("denyExt").split(","):null,p=null,s={allowExt:r||["jpg","jpeg","png","gif"],maxSize:o||2e8,denyExt:u||["exe","php"]},c=n.attr("input-name");l&&(s.allowMime=l),a="ace_file"===n.attr("input-type")?{no_file:"没有选择文件 ...",btn_choose:"选择",btn_change:"更换文件",droppable:!1,thumbnail:!1}:{style:"well",btn_choose:"单击此处删除文件或单击“选择”",btn_change:null,no_icon:"ace-icon fa fa-cloud-upload",droppable:!0,thumbnail:"small"},s=$.extend(s,a),e+=e.indexOf("?")>=0?"&":"?",e+="sField="+c,s.before_remove=function(){var t=i.val();if(t){var a={};a[c]=t,$.ajax({type:"POST",url:e,data:a})}return i.val(""),!0},n.ace_file_input(s).on("change",function(){var t=aceFileInputAjax(n,e);t.done(function(t){0===t.code?(layer.msg("上传文件的地址为："+t.data.sFilePath,{icon:6}),i.val(t.data.sFilePath)):(layer.msg("上传文件出现错误Error:"+t.msg,{icon:5}),n.ace_file_input("apply_settings").ace_file_input("reset_input"))}).fail(function(){ajaxFail()}).always(function(){p&&clearTimeout(p),p=null,n.ace_file_input("loading",!1)}),t.promise()}).on("file.error.ace",function(t,e){layer.msg("文件上传出现错误："+validateFile(e),{icon:5}),t.preventDefault()})}Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t};