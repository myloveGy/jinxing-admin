function empty(e){return null==e||""===e}function validateFile(e){var t=[];return e&&"object"==typeof e&&((e.error_count.ext||e.error_count.mime)&&t.push("上传文件类型错误"),e.error_count.size&&t.push("上传文件过大")),t.join(";")}function aceFileInputAjax(e,t){var a=e.closest("form"),n=e.data("ace_input_files"),i=new $.Deferred;if(!n||0===n.length)return i.resolve(),i.promise();if("FormData"in window)formData_object=new FormData,$.each(a.serializeArray(),function(e,t){formData_object.append(t.name,t.value)}),formData_object.append(e.attr("name"),n[0]),e.ace_file_input("loading",!0),i=$.ajax({url:t,type:"Post",processData:!1,contentType:!1,dataType:"json",data:formData_object});else{var r="temporary-iframe-"+(new Date).getTime()+"-"+parseInt(1e3*Math.random()),o=$('<iframe id="'+r+'" name="'+r+'" \t\t\t\t\t\t\t\tframeborder="0" width="0" height="0" src="about:blank"\t\t\t\t\t\t\t\tstyle="position:absolute; z-index:-1; visibility: hidden;"></iframe>').insertAfter(a);a.append('<input type="hidden" name="temporary-iframe-id" value="'+r+'" />'),o.data("deferrer",i),a.attr({method:"POST",enctype:"multipart/form-data",target:r}),e.ace_file_input("loading",!0),a.get(0).submit(),ie_timeout=setTimeout(function(){ie_timeout=null,o.attr("src","about:blank").remove(),i.reject({status:"fail",message:"Timeout!"})},3e4)}return i}function aceFileUpload(e,t){var a,n=$(e),i=$("input[type=hidden][name="+n.attr("input-name")+"]"),r=n.attr("allowExt")?n.attr("allowExt").split(","):null,o=n.attr("allowMime")?n.attr("allowMime").split(","):null,l=parseInt(n.attr("maxSize")),u=n.attr("denyExt")?n.attr("denyExt").split(","):null,s=null,p={allowExt:r||["jpg","jpeg","png","gif"],maxSize:l||2e8,denyExt:u||["exe","php"]},c=n.attr("input-name");o&&(p.allowMime=o),a="ace_file"===n.attr("input-type")?{no_file:"没有选择文件 ...",btn_choose:"选择",btn_change:"更换文件",droppable:!1,thumbnail:!1}:{style:"well",btn_choose:"单击此处删除文件或单击“选择”",btn_change:null,no_icon:"ace-icon fa fa-cloud-upload",droppable:!0,thumbnail:"small"},p=$.extend(p,a),t+=t.indexOf("?")>=0?"&":"?",t+="sField="+c,p.before_remove=function(){var e=i.val();if(e){var a={};a[c]=e,$.ajax({type:"POST",url:t,data:a})}return i.val(""),!0},n.ace_file_input(p).on("change",function(){var e=aceFileInputAjax(n,t);e.done(function(e){0===e.code?(layer.msg("上传文件的地址为："+e.data.sFilePath,{icon:6}),i.val(e.data.sFilePath)):(layer.msg("上传文件出现错误Error:"+e.msg,{icon:5}),n.ace_file_input("apply_settings").ace_file_input("reset_input"))}).fail(function(){ajaxFail()}).always(function(){s&&clearTimeout(s),s=null,n.ace_file_input("loading",!1)}),e.promise()}).on("file.error.ace",function(e,t){layer.msg("文件上传出现错误："+validateFile(t),{icon:5}),e.preventDefault()})}function ajax(e,t,a,n){var i=layer.load();return $.ajax({url:e,data:t,type:"POST",dataType:"json"}).done(function(e){0===e.code?a(e.data):n?n(e):layer.msg(e.msg,{icon:5})}).fail(function(){layer.msg("服务器繁忙,请稍后再试...",{icon:5})}).always(function(){layer.close(i)})}Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};